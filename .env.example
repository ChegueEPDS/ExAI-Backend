# =========================
# Server / URLs / CORS
# =========================
# Used by: `app.js` — runtime environment (development/production).
NODE_ENV=development
# Used by: `app.js` — bind address for HTTP server.
HOST=0.0.0.0
# Used by: `app.js` — port for HTTP server.
PORT=3000
# Used by: `services/datasetIngestionService.js`, `services/standardIngestionService.js`, `controllers/billingController.js` — absolute base URL for internal callbacks + links.
BASE_URL=http://localhost:3000
# Used by: `controllers/billingController.js` — frontend base URL for redirects/links.
FRONTEND_BASE_URL=http://localhost:4200
# Optional: override SPA dist folder path served by backend, i dont use it
# Used by: `app.js` — overrides SPA dist folder path (admin UI).
FRONTEND_DIST=
# Used by: `app.js` — CORS allow-list (comma separated origins).
# Supports:
# - exact origins: https://certs.atexdb.eu
# - wildcard origin: https://*.insp-ex.com
# - hostname suffix: *.atexdb.eu
# Example (local dev): http://localhost:4200,http://localhost:8100
# Example (prod): https://demo.epds.eu,https://*.epds.eu
CORS_ALLOWED_ORIGINS=http://localhost:4200,http://localhost:8100

# Optional: disable background schedulers/workers (0/1)
# Used by: `app.js` — disables schedulers/workers when set.
DISABLE_BACKGROUND_JOBS=0

# =========================
# Database / Auth
# =========================
# Production note: store secrets in Azure Key Vault and inject via App Service Key Vault References.
# See `Backend/KEYVAULT.md` for the exact naming + mapping table.
# Used by: `config/db.js` — MongoDB connection string.
MONGO_URI=
# Used by: `middlewares/authMiddleware.js`, `controllers/authController.js` — JWT signing/verifying secret.
JWT_SECRET=
# Used by: `controllers/authController.js` — JWT expiry for web clients.
JWT_EXPIRES_IN_WEB=1h
# Used by: `controllers/authController.js` — JWT expiry for mobile clients.
JWT_EXPIRES_IN_MOBILE=30d
# legacy default
# Used by: `controllers/authController.js` — legacy default JWT expiry.
JWT_EXPIRES_IN=1h

# =========================
# OpenAI (embeddings + chat + assistants)
# =========================
# Production note: `OPENAI_API_KEY` should come from Key Vault (App Service reference). Local dev can use `Backend/.env`.
# Used by: `controllers/governedChatController.js`, `services/*IngestionService.js`, `helpers/openaiCertExtractor.js` — OpenAI API key.
OPENAI_API_KEY=

# Embeddings
# Used by: `services/datasetIngestionService.js`, `services/standardIngestionService.js` — embedding model name.
RAG_EMBEDDING_MODEL=text-embedding-3-small

# NOTE: Chat model + governed RAG tuning knobs are configured in the UI:
# EPDS → Admin → System settings (SuperAdmin only). These values are stored in MongoDB and apply globally to all tenants.

# Optional: concurrency/retry tuning
# Used by: `controllers/certificateDraftController.js` — OpenAI retry attempts for extraction calls.
OPENAI_RETRY_ATTEMPTS=5
# Used by: `controllers/certificateDraftController.js` — OpenAI retry base delay (ms).
OPENAI_RETRY_BASE_MS=500
# Used by: `controllers/certificateDraftController.js` — OpenAI retry max delay (ms).
OPENAI_RETRY_MAX_MS=5000
# Used by: `controllers/conversationController.js` — max pages processed in legacy vector-store ingestion.
OPENAI_VS_MAX_PAGES=200

# Assistants (legacy endpoints)
# Used by: `services/assistantRunner.js`, `controllers/conversationController.js` — per-tenant assistant selection (fallback).
ASSISTANT_ID=
# Used by: `config/assistants.js`, `services/conversationService.js` — default assistant id.
ASSISTANT_ID_DEFAULT=
# Used by: `config/assistants.js` — tenant-specific assistant id (epds).
ASSISTANT_ID_EPDS=
# Used by: `helpers/openaiCertExtractor.js` — certificate extraction assistant id override.
ASSISTANT_ID_CERT=
# Used by: `config/assistants.js` — tenant-specific assistant id.
ASSISTANT_ID_PGMED=
# Used by: `config/assistants.js` — tenant-specific assistant id.
ASSISTANT_ID_VIRESOL=
# Used by: `config/assistants.js` — tenant-specific assistant id.
ASSISTANT_ID_XIII=
# Used by: `config/assistants.js` — tenant-specific assistant id.
ASSISTANT_ID_TUZ=
# Used by: `config/assistants.js` — tenant-specific assistant id.
ASSISTANT_ID_STAND98=
# Used by: `config/assistants.js` — tenant-specific assistant id.
ASSISTANT_ID_BGC=
# Used by: `config/assistants.js` — tenant-specific assistant id.
ASSISTANT_ID_DRND=
# Used by: `config/assistants.js` — tenant-specific assistant id.
ASSISTANT_ID_ARCHICON=
# Used by: `config/assistants.js` — tenant-specific assistant id.
ASSISTANT_ID_ROBEX=
# Used by: `config/assistants.js`, `controllers/conversationController.js` — tenant-specific assistant id (wolff).
ASSISTANT_ID_WOLFF=

# =========================
# Pinecone (optional vector store)
# =========================
# `PINECONE_API_KEY` should come from Key Vault in production. Local dev can leave Pinecone disabled.
# Used by: `services/pineconeService.js` — Pinecone API key.
PINECONE_API_KEY=
# Used by: `services/pineconeService.js` — Pinecone index name.
PINECONE_INDEX=
# Optional for serverless
# Used by: `services/pineconeService.js` — Pinecone host (serverless).
PINECONE_HOST=
# Optional: fixed namespace or template (defaults to t:{tenantId}:p:{projectId})
# Used by: `services/pineconeService.js` — override namespace with a fixed value.
PINECONE_NAMESPACE=
# Used by: `services/pineconeService.js` — namespace template with `{tenantId}` and `{projectId}`.
PINECONE_NAMESPACE_TEMPLATE=t:{tenantId}:p:{projectId}
# Used by: `services/pineconeService.js` — upsert batch size.
PINECONE_UPSERT_BATCH=100

# =========================
# Azure Blob Storage
# =========================
# `AZURE_STORAGE_CONNECTION_STRING` should come from Key Vault in production.
# Used by: `services/azureBlobService.js` — Azure Storage connection string.
AZURE_STORAGE_CONNECTION_STRING=
# Used by: `services/azureBlobService.js` — blob container name.
AZURE_BLOB_CONTAINER_NAME=certificates

# =========================
# Azure Document Intelligence (used by /api/pdfcert)
# =========================
# Secrets/Endpoints can be stored in Key Vault in production.
# Used by: `controllers/imgOcrController.js` — Azure Document Intelligence endpoint.
AZURE_FORM_RECOGNIZER_ENDPOINT=
# Used by: `controllers/imgOcrController.js` — Azure Document Intelligence key.
AZURE_FORM_RECOGNIZER_KEY=
# Used by: `controllers/imgOcrController.js` — polling interval in ms for PDF OCR.
AZURE_FORM_RECOGNIZER_POLL_INTERVAL_MS=2500
# Used by: `controllers/imgOcrController.js` — timeout in ms for PDF OCR.
AZURE_FORM_RECOGNIZER_TIMEOUT_MS=300000

# =========================
# Azure OCR (images)
# =========================
# Secrets/Endpoints can be stored in Key Vault in production.
# Used by: `controllers/imgOcrController.js` — Azure Computer Vision endpoint (image OCR).
AZURE_OCR_ENDPOINT=
# Used by: `controllers/imgOcrController.js` — Azure Computer Vision key (image OCR).
AZURE_OCR_KEY=

# =========================
# Azure Custom Vision (fireController)
# =========================
# Used by: `controllers/fireController.js` — Custom Vision endpoint.
AZURE_ENDPOINT=
# Used by: `controllers/fireController.js` — Custom Vision prediction key.
PREDICTION_KEY=
# Used by: `controllers/fireController.js` — upload folder for annotated images.
UPLOAD_FOLDER=uploads

# =========================
# Azure AI Search (optional)
# =========================
# Used by: `helpers/azureSearchHelpers.js` — Azure AI Search URL.
AZURE_SEARCH_URL=
# Used by: `helpers/azureSearchHelpers.js` — Azure AI Search index name.
AZURE_INDEX_NAME=
# Used by: `helpers/azureSearchHelpers.js` — Azure AI Search API key.
AZURE_API_KEY=

# =========================
# Azure Entra ID (Microsoft Graph)
# =========================
# Secrets can be stored in Key Vault in production.
# Used by: `services/graphClient.js` — Entra tenant ID.
AZURE_TENANT_ID=
# Used by: `services/graphClient.js` — Entra client ID.
AZURE_CLIENT_ID=
# Used by: `services/graphClient.js` — Entra client secret.
AZURE_CLIENT_SECRET=

# =========================
# Mail / Brevo
# =========================
# `BREVO_API_KEY` should come from Key Vault in production.
# Used by: `services/mailService.js`, `controllers/authController.js` — sender UPN/email for Graph mail.
MAIL_SENDER_UPN=
# Used by: `services/mailService.js` — save sent items (0/1).
MAIL_SAVE_TO_SENT=0

# Used by: `services/brevoService.js` — Brevo API key.
BREVO_API_KEY=
# Used by: `services/brevoService.js` — Brevo base URL.
BREVO_BASE_URL=
# Used by: `services/brevoService.js` — request timeout (ms).
BREVO_TIMEOUT_MS=10000
# Used by: `services/brevoService.js` — verbose debug logging (0/1).
BREVO_DEBUG=0
# Used by: `services/brevoService.js` — trace logging (0/1).
BREVO_TRACE=0
# Used by: `services/brevoService.js` — enable welcome emails (0/1).
BREVO_SEND_WELCOME=0
# Used by: `services/brevoService.js` — welcome template id.
BREVO_WELCOME_TEMPLATE_ID=
# Used by: `services/brevoService.js` — default list id.
BREVO_LIST_ID=
# optional multiple list ids (comma separated)
# Used by: `services/brevoService.js` — multiple list ids (comma separated).
BREVO_LIST_IDS=

# =========================
# Billing / Stripe
# =========================
# Stripe secrets should come from Key Vault in production.
# Used by: `controllers/billingController.js`, `controllers/billingWebhookController.js` — Stripe secret key.
STRIPE_SECRET_KEY=
# Used by: `controllers/billingWebhookController.js` — Stripe webhook secret.
STRIPE_WEBHOOK_SECRET=
# Used by: `controllers/billingController.js` — Stripe price id for PRO monthly.
STRIPE_PRICE_PRO=
# Used by: `controllers/billingController.js` — Stripe price id for PRO yearly.
STRIPE_PRICE_PRO_YEARLY=
# Used by: `controllers/billingController.js` — Stripe price id for TEAM monthly.
STRIPE_PRICE_TEAM=
# Used by: `controllers/billingController.js` — Stripe price id for TEAM yearly.
STRIPE_PRICE_TEAM_YEARLY=
# Used by: `controllers/billingController.js` — whether to collect phone in checkout (0/1).
STRIPE_CHECKOUT_COLLECT_PHONE=0
# Used by: `controllers/billingController.js` — success redirect URL (fallback if not using FRONTEND_BASE_URL).
BILLING_SUCCESS_URL=
# Used by: `controllers/billingController.js` — cancel redirect URL (fallback if not using FRONTEND_BASE_URL).
BILLING_CANCEL_URL=
# Used by: `controllers/billingController.js` — delay before redirect back from portal (ms).
PORTAL_RETURN_WAIT_MS=0

# =========================
# reCAPTCHA v3 (login/forgot password protection)
# =========================
# `RECAPTCHA_SECRET` should come from Key Vault in production.
# Used by: `middlewares/captchaMiddleware.js` — reCAPTCHA secret key.
RECAPTCHA_SECRET=
# Used by: `middlewares/captchaMiddleware.js` — minimum allowed score.
RECAPTCHA_MIN_SCORE=0.5
# Disable verification entirely (0/1) – useful for local dev only
# Used by: `middlewares/captchaMiddleware.js` — disable reCAPTCHA checks.
RECAPTCHA_DISABLED=0
# Used by: `middlewares/captchaMiddleware.js` — enable stdout tracing (0/1).
RECAPTCHA_TRACE_STDOUT=0
# Used by: `middlewares/captchaMiddleware.js` — allow bypass header if enabled.
RECAPTCHA_BYPASS_ENABLED=false
# Used by: `middlewares/captchaMiddleware.js` — required value for bypass header.
RECAPTCHA_BYPASS_KEY=
# Used by: `middlewares/captchaMiddleware.js` — bypass header name.
RECAPTCHA_BYPASS_HEADER=x-captcha-bypass

# Legacy captcha flags (also accepted by middleware)
# Used by: `middlewares/captchaMiddleware.js` — legacy disable flag.
CAPTCHA_DISABLED=0
# Used by: `middlewares/captchaMiddleware.js` — legacy bypass enable flag.
CAPTCHA_BYPASS_ENABLED=0
# Used by: `middlewares/captchaMiddleware.js` — legacy bypass key.
CAPTCHA_BYPASS_KEY=

# App base URL for certs portal links (emails)
# Used by: `controllers/authController.js`, `controllers/inviteController.js`, `controllers/userController.js` — base URL for email links.
APP_BASE_URL_CERTS=https://certs.atexdb.eu
